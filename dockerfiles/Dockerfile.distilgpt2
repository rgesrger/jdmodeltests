# Use a lightweight Ubuntu base
FROM ubuntu:20.04

# Avoid prompts during install
ENV DEBIAN_FRONTEND=noninteractive

# Install minimal dependencies
RUN apt-get update && apt-get install -y \
    libstdc++6 \
    && rm -rf /var/lib/apt/lists/*

# Create directories for the binary and OpenWhisk action
RUN mkdir -p /app /action

# Copy the compiled model binary and ONNX model into the container
COPY ../junction-functions/distilgpt2/distilgpt2_infer /app/distilgpt2_infer
COPY ../models/distilgpt2.onnx /app/distilgpt2.onnx

# Copy wrapper script that OpenWhisk will call
COPY exec.sh /action/exec

# Make everything executable
RUN chmod +x /app/distilgpt2_infer /action/exec

# Set OpenWhisk entrypoint
CMD ["/action/exec"]